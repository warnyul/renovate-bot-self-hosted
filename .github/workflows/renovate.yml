name: Renovate
on:
  pull_request:
    branches: [ main ]
    paths-ignore: 
      '**.md'
  push:
    branches: [ main ]
    paths-ignore: 
      '**.md'
  workflow_dispatch:
    inputs:
      logLevel:
        description: >
          Renovate log levels are used to control the amount of detail that is output in the Renovate log files.
          Log levels range from fatal (no detail) to debug (most detail).
        required: true
        default: 'warn'
        options:
          - trace
          - debug
          - info
          - warn
          - error
          - fatal
  schedule:
    # The "*" (#42, asterisk) character has special semantics in YAML, so this
    # string has to be quoted.
    - cron: '0/30 * * * *'
jobs:
  renovate:
    runs-on: ubuntu-20.04
    permissions:
      contents: read
    steps:
      - name: Checkout
        uses: actions/checkout@v3.3.0
      - name: Request a Github token
        id: action-github-app-token
        uses: getsentry/action-github-app-token@v2.0.0
        with:
          app_id: ${{ secrets.APP_ID }}
          private_key: ${{ secrets.PRIVATE_KEY }}
      - name: Self-hosted Renovate
        uses: renovatebot/github-action@v34.109.1
        with:
          configurationFile: renovate-config.js
          token: ${{ steps.action-github-app-token.outputs.token }}
        env:
          LOG_LEVEL: ${{ inputs.logLevel || 'warn' }}
          RENOVATE_AUTODISCOVER: true

